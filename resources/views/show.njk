{% extends "parent.njk" %}

{% block scripts %}
<script>
$(function(){
    $('.englishDescriptionBox').hide();
    $('.showEnglish').on('click',function(e){
      e.preventDefault();
      //$(this).html('Hide the English version');
      $('.englishDescriptionBox').fadeToggle();
    });

    var str = document.getElementById("recipeDesc").innerHTML;
    var res = str.replace(/;/g, "<br><br>");
    document.getElementById("recipeDesc").innerHTML = res;
});
</script>
{% endblock %}

{% block content %}
<div class="row">
    {% for error in old('errors') %}
    <div class="alert alert-dismissible alert-danger">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>Hiba!</strong> {{ error.message }}
    </div>
    {% endfor %}
    <div class="panel panel-default">
      <div class="panel-heading"><h4>{{ recipe.name }}</h4></div>
        <div class="panel-body" id="recipeDesc">
          {{ recipe.description }}
        </div>
      <div class="panel-footer">
        {% if(recipe.category.name)==null %}
          <span class="label label-danger">Ez a recept nem szerepel semmilyen kategóriában.</span>
        {% else %}
          <span class="label label-info">{{ recipe.category.name }}</span>
        {% endif %}
      </div>
    </div>
    {% if (recipe.englishDescription!="") %}
    <p><a href="#" class="btn btn-info showEnglish">Show/hide the english version</a></p>
    <div class="englishDescriptionBox">
        <p class="lead">English version:</h4>
          <div class="panel panel-default">
            <div class="panel-heading"><h4>{{ recipe.englishName }}</h4></div>
              <div class="panel-body">
                {{ recipe.englishDescription }}
              </div>
            </div>
        {% else %}
        <p class="text-muted" style="padding-left: 15px;">Ennek a receptnek még nincsen angol verziója! <a href="/recipe/{{ recipe.id }}/translate" class="btn btn-link">Lefordítom!</a></p>
    </div>
    {% endif %}
    {% if (currentUser.id!=null) %}
    {% set isFavorite = "no" %}
      {% for favorite in favorites %}
        {% if favorite.user_id==currentUser.id and favorite.recipe_id==recipe.id %}
          <form action="/recipe/{{ recipe.id }}/removeFavorite" method="POST">
              {{ csrfField}}
              <input type="submit" class="btn btn-default pull-left" style="margin-right: 10px;" value="Törlöm a kedvencekből">
          </form>
          {% set isFavorite = "yes" %}
        {% endif %}
      {% endfor %}
      {% if(isFavorite=="no") %}
      <form action="/recipe/{{ recipe.id }}/favorite" method="POST">
            {{ csrfField}}
            <input type="submit" class="btn btn-warning pull-left" style="margin-right: 10px;" value="Kedvencekhez adom">
        </form>
      {% endif %}
    {% endif %}
    {% if (currentUser.id==recipe.user_id) %}
    <a href="/recipe/{{ recipe.id }}/edit" class="btn btn-primary pull-left" style="margin-right: 10px;">Recept szerkesztése</a>
    <form action="/recipe/{{ recipe.id }}/delete" method="POST">
        {{ csrfField}}
        <input type="submit" class="btn btn-danger" value="Recept törlése">
    </form>
    {% endif %}
</div>

{% endblock %}